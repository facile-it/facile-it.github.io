<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>Using Kotlin type-safe builders to create a DSL for Forms</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="referrer" content="always">
        <meta name="generator" content="Hugo 0.69.0" />
        


        
        
            
                <meta name="description" content="News, repos, tips &amp; trends from the Facile.it Engineering team!">
            
        

        
    
        <meta name="twitter:card" content="summary"/>
        
            <meta name="twitter:image:src" content="https://engineering.facile.it/images/kotlin-intro/logo_Kotlin.png"/>
        
    
    
    <meta name="twitter:title" content="Using Kotlin type-safe builders to create a DSL for Forms"/>
    <meta name="twitter:description" content="Here at Facile.it we are constantly dealing with a lot of forms: we use them to collect various information and data needed to feed our in-house comparing algorithms. These forms could be really complex, having multiple rules and dependencies between fields, and they are likely to be changed and tuned frequently.
When I joined Facile.it, a lot of forms within the Android app needed to be updated or modified and sticking with the existing strategy would have required me to do a lot of work just to add or remove a simple field."/>
    
        
            
        
    


<meta name="twitter:site" content="@FacileIt_Engr"/>


        <meta property="og:title" content="Using Kotlin type-safe builders to create a DSL for Forms" />
<meta property="og:description" content="Here at Facile.it we are constantly dealing with a lot of forms: we use them to collect various information and data needed to feed our in-house comparing algorithms. These forms could be really complex, having multiple rules and dependencies between fields, and they are likely to be changed and tuned frequently.
When I joined Facile.it, a lot of forms within the Android app needed to be updated or modified and sticking with the existing strategy would have required me to do a lot of work just to add or remove a simple field." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://engineering.facile.it/blog/eng/kotlin-dsl/" />
<meta property="article:published_time" content="2017-02-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-02-08T00:00:00+00:00" />

        <meta property="og:image" content="https://engineering.facile.it/images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        <meta itemprop="name" content="Using Kotlin type-safe builders to create a DSL for Forms">
<meta itemprop="description" content="Here at Facile.it we are constantly dealing with a lot of forms: we use them to collect various information and data needed to feed our in-house comparing algorithms. These forms could be really complex, having multiple rules and dependencies between fields, and they are likely to be changed and tuned frequently.
When I joined Facile.it, a lot of forms within the Android app needed to be updated or modified and sticking with the existing strategy would have required me to do a lot of work just to add or remove a simple field.">
<meta itemprop="datePublished" content="2017-02-08T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2017-02-08T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1321">



<meta itemprop="keywords" content="" />
        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/additional.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/monokai-sublime.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-22342495-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">Facile.it Engineering</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-folder-open-o">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="/authors/">
                            <i class="fa fa-pencil">&nbsp;</i>Authors
                    </a>
                </li>
            
                <li>
                    <a href="/ita/careers/">
                            <i class="fa fa-briefcase">&nbsp;</i>Careers
                    </a>
                </li>
            
                <li>
                    <a href="/eng/who-we-are/">
                            <i class="fa fa-users">&nbsp;</i>Who we are
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://engineering.facile.it">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://engineering.facile.it">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-folder-open-o">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/authors/">
                            <h3>
                                <i class="fa fa-pencil">&nbsp;</i>Authors
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/ita/careers/">
                            <h3>
                                <i class="fa fa-briefcase">&nbsp;</i>Careers
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/eng/who-we-are/">
                            <h3>
                                <i class="fa fa-users">&nbsp;</i>Who we are
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section id="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/operators-overview/">Operators: an overview</a></h3>
                                
                                <time class="published" datetime=
                                    '2020-03-24'>
                                    March 24, 2020</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/common-problems-faced-by-php-developers-in-consuming-an-ampq-message/">Common problems faced by PHP developers in consuming an AMQP message</a></h3>
                                
                                <time class="published" datetime=
                                    '2019-05-29'>
                                    May 29, 2019</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/continuous-deployment-from-gitlab-ci-to-k8s-using-docker-in-docker/">Continuous deployment from GitLab CI to Kubernetes using Docker-in-Docker</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-02-06'>
                                    February 6, 2018</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f&amp;text=Using%20Kotlin%20type-safe%20builders%20to%20create%20a%20DSL%20for%20Forms&amp;via=FacileIt_Engr" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f&amp;title=Using%20Kotlin%20type-safe%20builders%20to%20create%20a%20DSL%20for%20Forms" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f&amp;title=Using%20Kotlin%20type-safe%20builders%20to%20create%20a%20DSL%20for%20Forms" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f&amp;title=Using%20Kotlin%20type-safe%20builders%20to%20create%20a%20DSL%20for%20Forms" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f&amp;description=Using%20Kotlin%20type-safe%20builders%20to%20create%20a%20DSL%20for%20Forms" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2fkotlin-dsl%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/blog/eng/kotlin-dsl/">Using Kotlin type-safe builders to create a DSL for Forms</a></h1>
            
        
        
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2017-02-08'>
            8 February 2017
        </time>

        
            <a href="/authors/giacomo/" class="author">
            
                <span class="name">Giacomo Bresciani</span>
                <img src="https://www.gravatar.com/avatar/6f023540d4107d16eca48cd7fcdbed9b?d=404&amp;s=250" alt="Giacomo Bresciani avatar" />
            
            </a>
        

        
            <p>7 minute read</p>
        
    </div>
</header>


  


  

  <div id="content">
    <p>Here at Facile.it we are constantly dealing with a lot of <strong>forms</strong>: we use them to collect various information and data needed to feed our in-house comparing algorithms. These forms could be <strong>really complex</strong>, having multiple rules and dependencies between fields, and they are likely to be <strong>changed and tuned frequently</strong>.</p>
<p>When I joined Facile.it, a lot of forms within the Android app needed to be updated or modified and sticking with the existing strategy would have required me to do <strong>a lot of work</strong> just to add or remove a simple field. So I took a step back and I started thinking about a strategy that would have allowed me to define and structure a form in a more <em>flexible</em> and <em>declarative</em> way. I wanted to be able to declare the <strong>relationships</strong> between fields, their <strong>validation rules</strong> and their <strong>serialized representation</strong> (how they are sent to the server).</p>
<p>I firstly thought about defining it using some configuration file, maybe written in JSON or YAML. The <em>problem</em> with this strategy was that it would also have required me to write a lot code to parse and validate those files to be able to create some sort of representation of the form in Java&hellip;but don&rsquo;t we already have the compiler for this kind of jobs?</p>
<p>I still wanted to be able to have both a <strong>human readable representation</strong> of the form and the right degree of <strong>flexibility</strong> to integrate the form definition into the app code.
So I thought that creating a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">Domain-Specific Language</a> would have been a perfect strategy to solve the problem in an elegant and efficient way.
Writing a DSL in Java could have ended up into something like that:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Form<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">openSection</span><span style="color:#f92672">(</span>sectionId<span style="color:#f92672">)</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span>key1<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;label1&#34;</span><span style="color:#f92672">,</span> style<span style="color:#f92672">,</span> <span style="color:#f92672">...)</span> 
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span>key2<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;label2&#34;</span><span style="color:#f92672">,</span> style<span style="color:#f92672">,</span> <span style="color:#f92672">...)</span> 
    <span style="color:#f92672">.</span><span style="color:#a6e22e">field</span><span style="color:#f92672">(</span>key3<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;label3&#34;</span><span style="color:#f92672">,</span> style<span style="color:#f92672">,</span> <span style="color:#f92672">...)</span> 
    <span style="color:#f92672">.</span><span style="color:#a6e22e">closeSection</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">...</span>
    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">()</span>
</code></pre></div><p>I don&rsquo;t think the previous code is readable nor flexible and it requires a lot of boilerplate to be written.</p>
<h2 id="kotlin-to-the-rescue">Kotlin to the rescue!</h2>
<p>Unlike Java, Kotlin (take a look at my <a href="https://engineering.facile.it/blog/eng/kotlin-intro/">previous post</a> about it) has a lot of features that makes it really powerful when it comes to write internal DSLs. The results are very similar to Groovy (think about a Gradle file) but thanks to its type system they could be <a href="https://kotlinlang.org/docs/reference/type-safe-builders.html#type-safe-builders">Type-Safe</a>.</p>
<p>The builders you can write with Kotlin are extremely readable and easy to understand even for people that don&rsquo;t know either the language or the DSL itself. Here&rsquo;s how a form built using my final DSL looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> FORM = form {
    page(<span style="color:#e6db74">&#34;Page 1 Title&#34;</span>) {
        section(<span style="color:#e6db74">&#34;Section 1 Title&#34;</span>) {
            field(key = <span style="color:#e6db74">&#34;fieldKey1&#34;</span>) {
                checkbox(<span style="color:#e6db74">&#34;Checkbox Field Label&#34;</span>) {
                    boolToStringConverter = { <span style="color:#66d9ef">if</span> (it == <span style="color:#66d9ef">true</span>) <span style="color:#e6db74">&#34;Yes&#34;</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;No&#34;</span> }
                    rules = { listOf(NotMissing()) }
                }
            }
            field(key = <span style="color:#e6db74">&#34;fieldKey2&#34;</span>) {
                picker(<span style="color:#e6db74">&#34;Picker Field Label&#34;</span>) {
                    placeHolder = <span style="color:#e6db74">&#34;Select a value&#34;</span>
                    possibleValues = Available(listOf(
                            <span style="color:#ae81ff">1</span> keyTo <span style="color:#e6db74">&#34;Value1&#34;</span>,
                            <span style="color:#ae81ff">2</span> keyTo <span style="color:#e6db74">&#34;Value2&#34;</span>,
                            <span style="color:#ae81ff">3</span> keyTo <span style="color:#e6db74">&#34;Value3&#34;</span>))
                    representation = IF_VISIBLE representAs SIMPLE_KEY_TO_VALUE
                }
            }
        }
        section(<span style="color:#e6db74">&#34;Section 2 Title&#34;</span>) {
            field(key = <span style="color:#e6db74">&#34;fieldKey3&#34;</span>) {
                picker(<span style="color:#e6db74">&#34;Picker Field Label&#34;</span>) {
                    placeHolder = <span style="color:#e6db74">&#34;Select a value&#34;</span>
                    possibleValues = ToBeRetrieved(someWebService.getValues())
                    representation = IF_VISIBLE representAs SIMPLE_KEY_TO_VALUE
                }
            }
            field(key = <span style="color:#e6db74">&#34;fieldKey4&#34;</span>) {
                input(<span style="color:#e6db74">&#34;Input Text Field Label&#34;</span>) {
                    inputTextType = InputTextType.EMAIL
                    rules = { listOf(IsEmail()) }
                }
            }
            field(key = <span style="color:#e6db74">&#34;fieldKey&#34;</span>) {
				        empty(<span style="color:#e6db74">&#34;Empty Field&#34;</span>)
            }
        }
		    section(<span style="color:#e6db74">&#34;Section 3 Title&#34;</span>) {
            field(key = <span style="color:#e6db74">&#34;fieldKey6&#34;</span>) {
                toggle(<span style="color:#e6db74">&#34;Toggle Field Label&#34;</span>) {
                    boolToStringConverter = { <span style="color:#66d9ef">if</span> (it == <span style="color:#66d9ef">true</span>) <span style="color:#e6db74">&#34;OK&#34;</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;KO&#34;</span> }
                    rules = { listOf(NotMissing()) }
                    representation = ALWAYS representAs SIMPLE_KEY_TO_VALUE
                }
            }
        }
    }
}
</code></pre></div><p>And this is the result on Android using my <a href="https://github.com/brescia123/forms">Form library</a>:</p>
<p><img src="/images/kotlin-dsl/form_screen.png" alt="Form screenshot"></p>
<p>Cool, isn&rsquo;t it?</p>
<h2 id="type-safe-builders">Type-safe builders</h2>
<h3 id="some-kotlin-important-features">Some Kotlin important features</h3>
<p>To grasp how Type-safe builders work in Kotlin we need to understand some key Kotlin features and how they can be combined together:</p>
<ul>
<li><strong>Higher-Order Functions and Lambdas</strong>: in Kotlin we are allowed to write functions that have <em>functions as parameters or return type</em> (higher-order functions) and functions that are <em>not declared</em>, but are passed immediately as an expression (lambdas). Because of this, we can write things like:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#75715e">// Higher-Order Function
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">transformWith</span>(path: String, function: (String) -&gt; List&lt;String&gt;): List&lt;String&gt; {
    <span style="color:#66d9ef">return</span> function(<span style="color:#66d9ef">this</span>)
}

<span style="color:#75715e">// Lambda
</span><span style="color:#75715e"></span>{ path: String -&gt; path.split(<span style="color:#e6db74">&#34;/&#34;</span>) }
</code></pre></div><p>Thanks to Kotlin syntactic sugar we can use them in these ways:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">transformWith(<span style="color:#e6db74">&#34;some/path/to&#34;</span>, { path: String -&gt; path.split(<span style="color:#e6db74">&#34;/&#34;</span>) }) <span style="color:#75715e">// -&gt; [some, path, to]
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Functions which have a function as the last parameter can be written as follow
</span><span style="color:#75715e"></span>transformWith(<span style="color:#e6db74">&#34;some/path/to&#34;</span>) { path -&gt; path.split(<span style="color:#e6db74">&#34;/&#34;</span>) } <span style="color:#75715e">// -&gt; [some, path, to]
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// If the lambda has only one parameter it can be ommitted and referenced as &#34;it&#34;
</span><span style="color:#75715e"></span>transformWith(<span style="color:#e6db74">&#34;some/path/to&#34;</span>) { it.split(<span style="color:#e6db74">&#34;/&#34;</span>) } <span style="color:#75715e">// -&gt; [some, path, to]
</span></code></pre></div><ul>
<li><strong>Extension Functions</strong>: they allow us to <em>extend</em> a type with functions without modifying the original class. They are useful to add functionalities to classes we don&rsquo;t have control on or to create utility methods without the need to create &ldquo;Utils classes&rdquo; that contains static methods, as we are used to as Java developers. To continue the previous example we can write:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#75715e">// Extension function
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">String</span>.transformWith(function: (String) -&gt; List&lt;String&gt;) {
    <span style="color:#66d9ef">return</span> function(<span style="color:#66d9ef">this</span>)
}

<span style="color:#e6db74">&#34;some/path/to&#34;</span>.transformWith { receiverString: String -&gt; receiverString(<span style="color:#e6db74">&#34;/&#34;</span>) } <span style="color:#75715e">// -&gt; [some, path, to]
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// or more concisely 
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;some/path/to&#34;</span>.transformWith { it.split(<span style="color:#e6db74">&#34;/&#34;</span>) } <span style="color:#75715e">// -&gt; [some, path, to]
</span></code></pre></div><p>Note that we are referring to the string inside the closure of the extension function using <code>this</code> as it will be the String object on which the method will be called.</p>
<ul>
<li><strong>Function Literals with Receiver</strong>: similarly to extension functions you are also allowed to define functions with a receiver that will be referred to as <code>this</code> inside the literal closure:</li>
</ul>
<pre><code>val transformWith: String.() -&gt; List&lt;String&gt; = { this.split(&quot;/&quot;) }

&quot;some/path/to&quot;.transformWith() // -&gt; [some, path, to]
</code></pre><p>To better understand function literals with receiver you should think of them as follow: <em>lambda is to normal function as function literal with receiver is to extension function</em>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#75715e">// lambda
</span><span style="color:#75715e"></span>{ s: String -&gt; s.split(<span style="color:#e6db74">&#34;/&#34;</span>) }
<span style="color:#75715e">// is to
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">function</span>(s: String): List&lt;String&gt; { <span style="color:#66d9ef">return</span> s.split(<span style="color:#e6db74">&#34;/&#34;</span>) }
<span style="color:#75715e">// as
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> functionLiteralWithReceiver = String.() -&gt; List&lt;String&gt; = { <span style="color:#66d9ef">this</span>.split(<span style="color:#e6db74">&#34;/&#34;</span>) }
<span style="color:#75715e">// is to
</span><span style="color:#75715e"></span><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">String</span>.extensionFunction(): List&lt;String&gt; { <span style="color:#66d9ef">return</span> function(<span style="color:#66d9ef">this</span>) }
</code></pre></div><p>Basically function literals with receiver are extension functions that can be passed to other functions.</p>
<h3 id="wrapping-up">Wrapping up</h3>
<p>Now we have all the elements required to understand and write a Type-safe builder.</p>
<p>Combining the above mentioned Kotlin features we can now write a function and name it <code>form</code>. This function will take as parameter a function literal with receiver usually called <code>init()</code> and will do the follow:</p>
<ul>
<li>create a new Form object</li>
<li>call <code>init()</code> on it (that is using it as the receiver of the function literal)</li>
<li>return the built object to the caller</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">form</span>(init: Form.() -&gt; Unit): Form {
    <span style="color:#66d9ef">val</span> form = Form() 
    form.init()
    <span style="color:#66d9ef">return</span> form
}
</code></pre></div><p>Now let&rsquo;s imagine that our Form class defines a function <code>field()</code> that actually creates a field object and adds it to the list of fields contained within the form:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Form</span>() {
    <span style="color:#66d9ef">val</span> fields: List&lt;Field&gt;
    ...
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">field</span>(key: String) { ... }
    ...
}
</code></pre></div><p>Taking advantage of Kotlin syntactic sugar we can use <code>form()</code> passing it the <code>init()</code> function as a lambda and call methods on the Form object to build it as follow:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">val</span> builtForm = form() {
    <span style="color:#75715e">// Here we can take advantage of the compiler and, as a result, of the IDE code completion
</span><span style="color:#75715e"></span>    field(<span style="color:#e6db74">&#34;key1&#34;</span>) <span style="color:#75715e">// == this.field(&#34;key1&#34;) where this is the object create by form()
</span><span style="color:#75715e"></span>    field(<span style="color:#e6db74">&#34;key2&#34;</span>)
}
builtForm.getFields() <span style="color:#75715e">// -&gt; [Field(&#34;key1&#34;), Field(&#34;key2&#34;)]
</span></code></pre></div><p>As you can see Type-Safe builders are an <strong>extremely powerful</strong> and useful feature of Kotlin and they allow you to write very complex DSLs with a <strong>really readable and clear syntax</strong>. They give you a lot of <strong>flexibility</strong> letting you combine multiple builders to create a domain language that can meet your requirements.</p>
<p>If you want to learn more about this subject check out the official <a href="https://github.com/Kotlin/kotlinx.html">documentation</a> or, for example, <a href="https://github.com/Kotlin/kotlinx.html">kotlinx</a>, an official project from the Kotlin team that allows you to create HTML documents with a custom DSL entirely written with Type-safe builders.</p>

  </div>

  

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/english">English</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/java">Java</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/kotlin">Kotlin</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/jvm">JVM</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/android">Android</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/dsl">DSL</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "facile-it" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/blog/eng/angular-components-from-angularjs-to-just-angular/"
                class="button big previous">Angular Components: from AngularJS to &#34;just Angular&#34;</a></li>
    

    
        <li><a href="/blog/ita/facilehack-2017-ci-siamo-quasi/"
                class="button big next">#FacileHack 2017 ci siamo quasi</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/images/logo_engineering.png" width="100%" alt="Facile.it Engineering" /></a>
      
    
    
      <header>
        <h2></h2>
        <p>News, repos, tips & trends from the Facile.it Engineering team!</p>
      </header>
    
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/facile-it" target="_blank" title="GitHub" class="fa fa-github"></a></li>



























  <li><a href="//linkedin.com/company/facile-it" target="_blank" title="LinkedIn Company" class="fa fa-linkedin"></a></li>









  <li><a href="//facebook.com/facile.it" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>









  <li><a href="//youtube.com/user/Facileit" target="_blank" title="YouTube" class="fa fa-youtube"></a></li>













  <li><a href="//instagram.com/facile.it" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>





  <li><a href="//twitter.com/FacileIt_Engr" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  <section id="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/andrea-rinaldi/" class="author" title="See other posts from Andrea Rinaldi">
                      <img src="https://avatars2.githubusercontent.com/u/23659024?s=400&amp;u=87e31f00acb07b57c9ed3da79e3d3d2d3f19b52c&amp;v=4" alt="Andrea Rinaldi avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/operators-overview/">Operators: an overview</a>
              </h3>
              
              <time class="published" datetime='2020-03-24'>
                24 March 2020
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/emulator000/" class="author" title="See other posts from Dario Cancelliere">
                      <img src="https://secure.gravatar.com/avatar/d2df7435df5986e9e5968d9a75c407b9" alt="Dario Cancelliere avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/common-problems-faced-by-php-developers-in-consuming-an-ampq-message/">Common problems faced by PHP developers in consuming an AMQP message</a>
              </h3>
              
              <time class="published" datetime='2019-05-29'>
                29 May 2019
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/jean/" class="author" title="See other posts from Alessandro Lai">
                      <img src="https://www.gravatar.com/avatar/5e9c1c380aa22f2df2f70be07ba35e90?d=404&amp;s=250" alt="Alessandro Lai avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/continuous-deployment-from-gitlab-ci-to-k8s-using-docker-in-docker/">Continuous deployment from GitLab CI to Kubernetes using Docker-in-Docker</a>
              </h3>
              
              <time class="published" datetime='2018-02-06'>
                6 February 2018
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /blog/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Top categories</a></h3>
      </header>
        
          
        

        
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/conferences/">Conferences</a>
                <span style="float:right;">10</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/docker/">Docker</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/english/">English</a>
                <span style="float:right;">30</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/functional-programming/">Functional programming</a>
                <span style="float:right;">10</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/italiano/">Italiano</a>
                <span style="float:right;">34</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/open-source/">Open Source</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/php/">PHP</a>
                <span style="float:right;">20</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/software-testing/">Software testing</a>
                <span style="float:right;">6</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/swift/">Swift</a>
                <span style="float:right;">8</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
        <p>
            <a href="/categories/" class="button">View more categories</a>
        </p>
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h1>
      <p>Facile.it relies on a big and keen crew of developers. Since 2008, the groupâ€™s projects are based on PHP, and as time goes by new technologies become part of corporate know how. This blog allows our developers to share tips and direct experiences with new technologies.</p>
      <a href="/ita/chi-siamo/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/facile-it" target="_blank" title="GitHub" class="fa fa-github"></a></li>



























  <li><a href="//linkedin.com/company/facile-it" target="_blank" title="LinkedIn Company" class="fa fa-linkedin"></a></li>









  <li><a href="//facebook.com/facile.it" target="_blank" title="Facebook" class="fa fa-facebook"></a></li>









  <li><a href="//youtube.com/user/Facileit" target="_blank" title="YouTube" class="fa fa-youtube"></a></li>













  <li><a href="//instagram.com/facile.it" target="_blank" title="Instagram" class="fa fa-instagram"></a></li>





  <li><a href="//twitter.com/FacileIt_Engr" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
    <p class="copyright">
      
        &copy; 2020
        
          Facile.it Engineering
        
      .
      <a href="/ita/disclaimer/" rel="nofollow">Disclaimer</a><br>
      Design <a href="http://html5up.net" rel="nofollow" target="_blank">HTML5 UP</a><br>
      Ported by <a href="//github.com/jpescador" rel="nofollow" target="_blank">Julio Pescador</a><br>
      Modified by <a href="//github.com/Jean85" rel="nofollow" target="_blank">Alessandro Lai</a><br>
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/kotlin.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/objectivec.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/python.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/swift.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
      <script type="text/javascript" src="/js/jquery-lazy/jquery.lazy.min.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript">
        $(function() {
            $('.lazy').Lazy();
        });
    </script>
  </body>
</html>

