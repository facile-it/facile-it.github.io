<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https:\/\/engineering.facile.it\/"
        },
        "articleSection" : "blog",
        "name" : "Optionals in Objective-C",
        "headline" : "Optionals in Objective-C",
        "description" : "\u003cp\u003e\u003cstrong\u003eObjective-C is not going anywhere\u003c\/strong\u003e. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:\u003c\/p\u003e\n\u003cul\u003e\n\u003cli\u003eObjective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, \u003cstrong\u003ecan be tricky\u003c\/strong\u003e and possibly unconvenient, due to the dynamic nature of the latter;\u003c\/li\u003e\n\u003cli\u003eSwift is changing rapidly, has still some bugs and \u003cstrong\u003eperformance problems\u003c\/strong\u003e, and still lacks some features that professionals need, while Objective-C is mature and has a strong community;\u003c\/li\u003e\n\u003cli\u003esome may \u003cstrong\u003eprefer a more dynamic language\u003c\/strong\u003e, and Objective-C support from Apple \u003ca href=\u0022https:\/\/netguru.co\/blog\/objective-c-generics\u0022\u003eis still strong\u003c\/a\u003e;\u003c\/li\u003e\n\u003c\/ul\u003e\n\u003cp\u003ePersonally, while I naturally lean towards a more static, \u003ca href=\u0022http:\/\/engineering.facile.it\/type-first-development-in-swift\/\u0022\u003etype-first\u003c\/a\u003e approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn\u0026rsquo;t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: \u003ca href=\u0022https:\/\/developer.apple.com\/library\/ios\/documentation\/Swift\/Conceptual\/Swift_Programming_Language\/TheBasics.html#\/\/apple_ref\/doc\/uid\/TP40014097-CH5-ID330\u0022\u003eOptionals\u003c\/a\u003e.\u003c\/p\u003e",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2015",
        "datePublished": "2015-11-09 00:00:00 \u002b0000 UTC",
        "dateModified" : "2015-11-09 00:00:00 \u002b0000 UTC",
        "url" : "https:\/\/engineering.facile.it\/blog\/eng\/optionals-in-objective-c\/",
        "wordCount" : "2927",
        "keywords" : [ "Blog" ]
    }
    </script>
        
            
                <title>Optionals in Objective-C</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="referrer" content="always">
        <meta name="generator" content="Hugo 0.134.2">
        


        
        
            
                <meta name="description" content="Objective-C is not going anywhere. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:

Objective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, can be tricky and possibly unconvenient, due to the dynamic nature of the latter;
Swift is changing rapidly, has still some bugs and performance problems, and still lacks some features that professionals need, while Objective-C is mature and has a strong community;
some may prefer a more dynamic language, and Objective-C support from Apple is still strong;

Personally, while I naturally lean towards a more static, type-first approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn&rsquo;t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: Optionals.">
            
        

        
<meta name="twitter:card" content="summary_large_image"/>

    
        <meta name="twitter:image" content="https://engineering.facile.it/images/social/social-preview.png"/>
        <meta name="og:image" content="https://engineering.facile.it/images/social/social-preview.png"/>
    



<meta name="og:title" content="Optionals in Objective-C"/>
<meta name="og:description" content="Objective-C is not going anywhere. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:

Objective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, can be tricky and possibly unconvenient, due to the dynamic nature of the latter;
Swift is changing rapidly, has still some bugs and performance problems, and still lacks some features that professionals need, while Objective-C is mature and has a strong community;
some may prefer a more dynamic language, and Objective-C support from Apple is still strong;

Personally, while I naturally lean towards a more static, type-first approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn&rsquo;t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: Optionals."/>


    
        <meta name="twitter:creator" content="@_logicist"/>
    



    <meta name="twitter:site" content="@FacileIt_Engr"/>



        <meta property="og:url" content="https://engineering.facile.it/blog/eng/optionals-in-objective-c/">
  <meta property="og:site_name" content="Facile.it Engineering">
  <meta property="og:title" content="Optionals in Objective-C">
  <meta property="og:description" content="Objective-C is not going anywhere. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:
Objective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, can be tricky and possibly unconvenient, due to the dynamic nature of the latter; Swift is changing rapidly, has still some bugs and performance problems, and still lacks some features that professionals need, while Objective-C is mature and has a strong community; some may prefer a more dynamic language, and Objective-C support from Apple is still strong; Personally, while I naturally lean towards a more static, type-first approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn’t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: Optionals.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2015-11-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2015-11-09T00:00:00+00:00">


        
            
                <meta property="og:image" content="https://engineering.facile.it/images/social/social-preview.jpg">
            
        

        
  <meta itemprop="name" content="Optionals in Objective-C">
  <meta itemprop="description" content="Objective-C is not going anywhere. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:
Objective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, can be tricky and possibly unconvenient, due to the dynamic nature of the latter; Swift is changing rapidly, has still some bugs and performance problems, and still lacks some features that professionals need, while Objective-C is mature and has a strong community; some may prefer a more dynamic language, and Objective-C support from Apple is still strong; Personally, while I naturally lean towards a more static, type-first approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn’t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: Optionals.">
  <meta itemprop="datePublished" content="2015-11-09T00:00:00+00:00">
  <meta itemprop="dateModified" content="2015-11-09T00:00:00+00:00">
  <meta itemprop="wordCount" content="2927">
  <meta itemprop="keywords" content="Elviro,English,Swift,Objective-C,Functional Programming,Monad">

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/additional.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/monokai-sublime.min.css' rel='stylesheet' type='text/css' />
  


      
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-1V6DNT10GR"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-1V6DNT10GR');
        }
      </script>
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">Facile.it Engineering</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-folder-open">&nbsp;</i>Categories
                    </a>
                </li>
            
                <li>
                    <a href="/authors/">
                            <i class="fa fa-pencil">&nbsp;</i>Authors
                    </a>
                </li>
            
                <li>
                    <a href="/ita/careers/">
                            <i class="fa fa-briefcase">&nbsp;</i>Careers
                    </a>
                </li>
            
                <li>
                    <a href="/eng/who-we-are/">
                            <i class="fa fa-users">&nbsp;</i>Who we are
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://engineering.facile.it/">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://engineering.facile.it/">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-folder-open">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/authors/">
                            <h3>
                                <i class="fa fa-pencil">&nbsp;</i>Authors
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/ita/careers/">
                            <h3>
                                <i class="fa fa-briefcase">&nbsp;</i>Careers
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/eng/who-we-are/">
                            <h3>
                                <i class="fa fa-users">&nbsp;</i>Who we are
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/v-protetto12-7-2024/">Venerdì Protetto | July edition</a></h3>
                                
                                <time class="published" datetime=
                                    '2024-08-28'>
                                    August 28, 2024</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/v-protetto14-6-2024/">Venerdì Protetto | June edition</a></h3>
                                
                                <time class="published" datetime=
                                    '2024-07-02'>
                                    July 2, 2024</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/eng/hack-the-box-experience/">Hack the Box Experience</a></h3>
                                
                                <time class="published" datetime=
                                    '2024-05-30'>
                                    May 30, 2024</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa-solid fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//x.com/share?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f&amp;text=Optionals%20in%20Objective-C&amp;via=FacileIt_Engr" target="_blank" class="share-btn twitter">
    <i class="fa-brands fa-square-x-twitter"></i>
    <p>X</p>
    </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f" target="_blank" class="share-btn facebook">
    <i class="fa-brands fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f&amp;title=Optionals%20in%20Objective-C" target="_blank" class="share-btn reddit">
    <i class="fa-brand fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f&amp;title=Optionals%20in%20Objective-C" target="_blank" class="share-btn linkedin">
      <i class="fa-brand fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f&amp;title=Optionals%20in%20Objective-C" target="_blank" class="share-btn stumbleupon">
    <i class="fa-brand fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f&amp;description=Optionals%20in%20Objective-C" target="_blank" class="share-btn pinterest">
    <i class="fa-brand fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fengineering.facile.it%2fblog%2feng%2foptionals-in-objective-c%2f" target="_blank" class="share-btn email">
    <i class="fa-solid fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/blog/eng/optionals-in-objective-c/">Optionals in Objective-C</a></h1>
            
        
        
        
            <p class="translated-article">
                Questo articolo è disponibile anche
                <a href="/blog/ita/optionals-in-objective-c/">in italiano</a>
            </p>
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2015-11-09'>
            9 November 2015
        </time>

        
            <a href="/authors/elviro/" class="author">
            
                <span class="name">Elviro Rocca</span>
                <img src="https://www.gravatar.com/avatar/fb2983ff4983323312496f2b67e26186?d=404&amp;s=250" alt="Elviro Rocca avatar" />
            
            </a>
        

        
            <p>14 minute read</p>
        
    </div>
</header>


  


  

  <div id="content">
    <p><strong>Objective-C is not going anywhere</strong>. While Swift is most certainly the new hotness for iOS and OS X programming, there are some concrete reasons to stick with Objective-C for a while:</p>
<ul>
<li>Objective-C based projects still need maintenance and new features to be added, and mixing Swift and Objective-C, while possible, <strong>can be tricky</strong> and possibly unconvenient, due to the dynamic nature of the latter;</li>
<li>Swift is changing rapidly, has still some bugs and <strong>performance problems</strong>, and still lacks some features that professionals need, while Objective-C is mature and has a strong community;</li>
<li>some may <strong>prefer a more dynamic language</strong>, and Objective-C support from Apple <a href="https://netguru.co/blog/objective-c-generics">is still strong</a>;</li>
</ul>
<p>Personally, while I naturally lean towards a more static, <a href="http://engineering.facile.it/type-first-development-in-swift/">type-first</a> approach to programming, from time to time I like to work in a more dynamic environment, so both for preference and for business needs, I still didn&rsquo;t put Objective-C completely away. But just after a few weeks of Swift I found myself missing one of the most powerful features of the language: <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/TheBasics.html#//apple_ref/doc/uid/TP40014097-CH5-ID330">Optionals</a>.</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#the-optional-type">The <code>Optional</code> type</a></li>
<li><a href="#optionals-in-swift">Optionals in Swift</a></li>
<li><a href="#back-to-objective-c">Back to Objective-C</a></li>
<li><a href="#example-a-json-parser">Example: a JSON parser</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<p><a name="the-optional-type"></a></p>
<h2 id="the-optional-type">The <code>Optional</code> type</h2>
<p>A Optional is a <em>generic</em> type, that is, a type that&rsquo;s dependent  (actually, <em>parametric</em>) on another <strong>subtype</strong>, so whe can have, for example, a <code>Optional&lt;String&gt;</code> or a <code>Optional&lt;Int&gt;</code>: thanks to some syntactic sugar, those types are written in Swift as <code>String?</code> and <code>Int?</code>. So, what is an <code>Optional</code>? It&rsquo;s a representation   of a value that could be there, and be of a particular subtype, or could not, therefore being <strong>nil</strong>: by <em>wrapping</em> the subtype into an <code>Optional</code>, the Swift compiler knows that the value could be nil, and complain in the cases where we are using an <code>Optional</code> where a value that&rsquo;s <strong>never</strong> nil is expected. By itself, this simple feature grants us a lot of type-safety for free: for example, in Swift we can&rsquo;t initialize a non-optional value with nil, and considering that, for the Swift&rsquo;s compiler, a value cannot be used before being initialized, by saying that a value&rsquo;s type is <code>String</code> the compiler will assure us that the value will <strong>always</strong> be a string, no matter what.</p>
<p>In contrast, Objective-C objects can always be nil, and if we expect something not to be nil, we are forced to check for the actual existence of everything at any time. But actually, that&rsquo;s not necessarily a big deal: it&rsquo;s a classic <strong>tradeoff</strong> of dynamic languages, and it can be even considered a <em>feature</em> by some people: in using a dynamically typed language, we are always expected to design our APIs with <a href="https://en.wikipedia.org/wiki/Late_binding">late binding</a> in mind. Also, the new <a href="https://developer.apple.com/swift/blog/?id=25">Objective-C nullability specifiers</a> will help the compiler trigger warnings when nil is passed to a property or method parameter when <code>nonnull</code> is expected. But the problem is still there: we need a lot of boilerplate to always check for <em>nullness</em>, and that can produce error-prone, less readable code. The need for this boilerplate is missing in Swift, and that&rsquo;s thanks to the nature of the <code>Optional</code> type: in fact, it works in the same way as the <code>Maybe</code> type in Haskell, or the <code>Option</code> type in Scala, that is, <code>Optional</code> is actually a <strong>monad</strong>.</p>
<p>The concept of <em>monad</em> is inherited by functional programming from <a href="https://en.wikipedia.org/wiki/Category_theory">category theory</a> and there are plenty of <a href="https://wiki.haskell.org/Monad">introductions</a> <a href="https://www.haskell.org/tutorial/monads.html">about it</a> <a href="http://learnyouahaskell.com/a-fistful-of-monads">on the web</a>, so I&rsquo;m not going into the specifics here: let me just say that a monad is a <em>computational context</em>, that is, a specification for the way some <em>computations</em> need to be resolved. Applying a certain transformation to a monad will result in another instance of the same monad, different from the first, based on the specific kind of monad. For example, applying some transformation to an <code>Optional</code> monad will result in applying the same transformation to the contained value if it&rsquo;s there, or absolutely nothing if the <code>Optional</code> contains nil: in both cases, the transformation&rsquo;s output will be another <code>Optional</code>, possibly of different subtype.</p>
<p><a name="optionals-in-swift"></a></p>
<h2 id="optionals-in-swift">Optionals in Swift</h2>
<p>Consider the following Swift code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Swift" data-lang="Swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">makeOptionalIntFrom</span>(value: Int, ifTrue: Bool) -&gt; Int?
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ifTrue ? value : <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> optionalInt = makeOptionalIntFrom(<span style="color:#ae81ff">3</span>, ifTrue: <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>print(optionalInt.<span style="color:#66d9ef">dynamicType</span>) <span style="color:#75715e">/// prints &#39;Optional&lt;Int&gt;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> toString: Int -&gt; String = { <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\(</span>$0<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> optionalString = optionalInt.map(toString)
</span></span><span style="display:flex;"><span>print(optionalString.<span style="color:#66d9ef">dynamicType</span>) <span style="color:#75715e">/// prints &#39;Optional&lt;String&gt;&#39;</span>
</span></span></code></pre></div><p>In the example, <code>optionalInt</code> is a <code>Int</code> wrapped into an <code>Optional</code>, thus having type <code>Optional&lt;Int&gt;</code> (Swift&rsquo;s syntactic sugar allows us to write <code>Int?</code>), and by applying the <code>toString</code> function to that <code>Optional</code> we get an instance of <code>Optional&lt;String&gt;</code>. We can see that, to actually apply the <code>toString</code> function to the <code>Optional</code>, we passed the function to the <code>map</code> method: this operation is usually called <a href="https://wiki.haskell.org/Lifting"><em>lifting</em> a function</a>, because the function <code>toString</code>, of type <code>Int -&gt; String</code>, is <em>lifted</em> into the type <code>Optional&lt;Int&gt; -&gt; Optional&lt;String&gt;</code>.</p>
<p>As we can see, no conditional statements were used in manipulating the optional integer: by <em>lifting</em> our transformations with the <code>map</code> method, we can apply them directly to the <code>Optional</code> instances, and we can also chain them pretty easily, for example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Swift" data-lang="Swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">makeOptionalIntFrom</span>(value: Int, ifTrue: Bool) -&gt; Int?
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ifTrue ? value : <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> optionalInt = makeOptionalIntFrom(<span style="color:#ae81ff">3</span>, ifTrue: <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>print(optionalInt.<span style="color:#66d9ef">dynamicType</span>) <span style="color:#75715e">/// prints &#39;Optional&lt;Int&gt;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> doubled: Int -&gt; Int = { $0<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> toString: Int -&gt; String = { <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\(</span>$0<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> optionalDoubledString = optionalInt.map(doubled).map(toString)
</span></span><span style="display:flex;"><span>print(optionalDoubledString.<span style="color:#66d9ef">dynamicType</span>) <span style="color:#75715e">/// prints &#39;Optional&lt;String&gt;&#39;</span>
</span></span></code></pre></div><p>If we want to express the opposite operation, we run into a problem: transforming a <code>String</code> into a <code>Int</code> is not always considered possible by Swift (for example, no numbers in the string), therefore the operation is optional. In fact:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Swift" data-lang="Swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">makeOptionalStringFrom</span>(value: String, ifTrue: Bool) -&gt; String?
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ifTrue ? value : <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> toInt: String -&gt; Int? = { Int($0) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> anotherOptionalString = makeOptionalStringFrom(<span style="color:#e6db74">&#34;3&#34;</span>, ifTrue: <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> anotherOptionalInt = anotherOptionalString.map(toInt).map(doubled)
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// this won&#39;t compile!</span>
</span></span></code></pre></div><p>The problem here is that <code>toInt</code> is a function of type <code>String -&gt; Optional&lt;Int&gt;</code>, and lifting the function to the <code>Optional</code> &ldquo;world&rdquo; will turn its type into something like <code>Optional&lt;String&gt; -&gt; Optional&lt;Optional&lt;Int&gt;&gt;</code>, that is, an optional integer wrapped into another optional: in <em>monadic</em> terminology, to lift functions that transforms the wrapped type into another instance of the same monad, we need a <code>flatMap</code> operation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Swift" data-lang="Swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> anotherOptionalInt = anotherOptionalString.flatMap(toInt).map(doubled)
</span></span><span style="display:flex;"><span><span style="color:#75715e">/// this is fine</span>
</span></span></code></pre></div><p>So, for the <code>Optional</code> type, <code>flatMap</code> works like <code>map</code> but for functions that transform the wrapped type into another <code>Optional</code>. In reading the code, <code>map</code> and <code>flatMap</code> can be basically treated as the same: they both indicate a transformation, and the fact that computations passed to <code>flatMap</code> are of slightly different type can be considered an implementation detail.</p>
<p>Actually, Swift treats these types <strong>a little differently</strong> than in other languages: for example, <code>map</code> and <code>flatMap</code> are usually <em>free functions</em> in most <em>functional</em> languages, while in Swift they are <strong>methods</strong>. In general, Swift encourages the use of methods and <strong>method chaining</strong> instead of free functions composed with special operators: it&rsquo;s mostly a matter of philosophy, but in bringing these features back to Objective-C, the method-based approach is going to be really useful because there&rsquo;s no easy syntax for free functions in the language, while methods have the signature clean and readable syntax that we&rsquo;re used to.</p>
<p><a name="back-to-objective-c"></a></p>
<h2 id="back-to-objective-c">Back to Objective-C</h2>
<p>Let&rsquo;s implement the <code>Optional</code> class in Objective-C:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import &lt;Foundation/Foundation.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>NS_ASSUME_NONNULL_BEGIN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Optional</span> : <span style="color:#a6e22e">NSObject</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">with:</span>(<span style="color:#66d9ef">id</span> _Nullable)value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">map:</span>(<span style="color:#66d9ef">id</span>(<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span>))mapBlock;
</span></span><span style="display:flex;"><span>- (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">flatMap:</span>(Optional<span style="color:#f92672">*</span>(<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span>))flatMapBlock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NS_ASSUME_NONNULL_END
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.m
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;Optional.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Optional</span> ()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">strong</span>, <span style="color:#66d9ef">nonatomic</span>, nullable) <span style="color:#66d9ef">id</span> value;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Optional</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">with:</span>(<span style="color:#66d9ef">id</span> _Nullable)value
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  Optional<span style="color:#f92672">*</span> optional <span style="color:#f92672">=</span> [Optional new];
</span></span><span style="display:flex;"><span>  optional.value <span style="color:#f92672">=</span> value;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> optional;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (Optional <span style="color:#f92672">*</span>)<span style="color:#a6e22e">map:</span>(<span style="color:#66d9ef">id</span>  _Nonnull (<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span> _Nonnull))mapBlock
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (self.value <span style="color:#f92672">!=</span> nil)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [Optional with:mapBlock(self.value)];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> self;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (Optional <span style="color:#f92672">*</span>)<span style="color:#a6e22e">flatMap:</span>(Optional<span style="color:#f92672">*</span> _Nonnull (<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span> _Nonnull))flatMapBlock
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (self.value <span style="color:#f92672">!=</span> nil)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> flatMapBlock(self.value);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> self;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>As we can see, the <code>with:</code> class method will create an <code>Optional</code> object by wrapping some other object, of unspecified class: because there&rsquo;s no true <em>generics</em> in Objective-C, we won&rsquo;t be able to make our Optional type as type-safe as in Swift, but as we&rsquo;ll see, it won&rsquo;t be a big deal and we&rsquo;ll still be able to get some really <strong>powerful features</strong>. The <code>map:</code> method will check if the wrapped object is not nil, and apply the transformation expressed by the <code>mapBlock</code> block only if the object is actually there: in this case, Objective-C nullability specifiers really help us in designing our APIs, because we clearly specified that <code>mapBlock</code> will accept and will return non-nil objects only. The <code>flatMapBlock</code> block will return instead another <code>Optional</code>.</p>
<p>We can test this by essentially recreating the same Swift example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Test.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import &lt;Foundation/Foundation.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Test</span> : <span style="color:#a6e22e">NSObject</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">testOptional</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Test.m
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;Test.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;Optional.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">Test</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">testOptional</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  Optional<span style="color:#f92672">*</span> optionalInt <span style="color:#f92672">=</span> [self makeOptionalIntFrom:<span style="color:#ae81ff">@3</span> ifTrue:YES];
</span></span><span style="display:flex;"><span>  Optional<span style="color:#f92672">*</span> optionalDoubledString <span style="color:#f92672">=</span> [[optionalInt
</span></span><span style="display:flex;"><span>                                      map:[self doubled]]
</span></span><span style="display:flex;"><span>                                     map:[self toString]];
</span></span><span style="display:flex;"><span>  NSLog(<span style="color:#e6db74">@&#34;%@&#34;</span>, optionalDoubledString);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">makeOptionalIntFrom:</span>(NSNumber<span style="color:#f92672">*</span>)fromInt <span style="color:#a6e22e">ifTrue:</span>(<span style="color:#66d9ef">BOOL</span>)ifTrue
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [Optional with:ifTrue <span style="color:#f92672">?</span> fromInt : nil];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (NSNumber<span style="color:#f92672">*</span>(<span style="color:#f92672">^</span>)(NSNumber<span style="color:#f92672">*</span>))<span style="color:#a6e22e">doubled</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>(NSNumber<span style="color:#f92672">*</span> value)  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@(</span>value.integerValue<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#ae81ff">)</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (NSString<span style="color:#f92672">*</span>(<span style="color:#f92672">^</span>)(NSNumber<span style="color:#f92672">*</span>))<span style="color:#a6e22e">toString</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">^</span>NSString<span style="color:#f92672">*</span>(NSNumber<span style="color:#f92672">*</span> value)  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;%@&#34;</span>, value];
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>Once we applied our transformations, we need a way to <em>unwrap</em> the object inside our <code>Optional</code>: in Swift this is done at language level, with some syntactic sugar, while in Objective-C we can follow the standard conventions of the functional programming community, that is, we can <em>get</em> the wrapped object via a <code>get</code> method.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span> _Nullable)<span style="color:#a6e22e">get</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.m
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">get</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> self.value;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Of course the <code>get</code> method will return an <code>id _Nullable</code>, which means that the returned object can (obviously) be nil. A frequent pattern when dealing with <code>nil</code> objects is replacing them with &ldquo;default&rdquo; versions: that can be useful when we don&rsquo;t really care about the data contained in an object, but we don&rsquo;t want to be exposed to the risk of possibly null references. Once again, with the <code>Optional</code> class we can avoid conditional statements and express the &ldquo;defaulting&rdquo; mechanism in a more declarative way: we just need to add a <code>getOrElse:</code> method, that will return the wrapped object if it&rsquo;s there, or will return a default object, that we&rsquo;ll pass to the method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">getOrElse:</span>(<span style="color:#66d9ef">id</span>(<span style="color:#f92672">^</span>)())elseBlock;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.m
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (<span style="color:#66d9ef">id</span>)<span style="color:#a6e22e">getOrElse:</span>(<span style="color:#66d9ef">id</span>  _Nonnull (<span style="color:#f92672">^</span>)())elseBlock
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (self.value <span style="color:#f92672">!=</span> nil)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> self.value;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> elseBlock();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As we can see, <code>getOrElse:</code> will <strong>not</strong> return a <code>_Nullable</code> object, and that&rsquo;s thanks to <code>elseBlock</code>: we&rsquo;re not passing the actual default object here, but a block that will produce one; this way, we can get the default object <strong>lazily</strong>, because if the wrapped object is not nil, the default object doesn&rsquo;t need to be allocated.</p>
<p>For the rest of the article we&rsquo;ll work on a more real-world example, and in doing so we&rsquo;ll add more features to the <code>Optional</code> class, making it more and more powerful.</p>
<p><a name="example-a-json-parser"></a></p>
<h2 id="example-a-json-parser">Example: a JSON parser</h2>
<p>Suppose we want to create an app that shows movie informations: we are retrieving those informations in JSON format from a website like <a href="http://api.myapifilms.com">myapifilms</a>. Each movie has a JSON representation like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;countries&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;USA&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;directors&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Frank Darabont&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;nameId&#34;</span>: <span style="color:#e6db74">&#34;nm0001104&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;filmingLocations&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;St. Croix&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;U.S. Virgin Islands&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;genres&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Crime&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Drama&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;idIMDB&#34;</span>: <span style="color:#e6db74">&#34;tt0111161&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;languages&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;English&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;metascore&#34;</span>: <span style="color:#e6db74">&#34;80/100&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;originalTitle&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;plot&#34;</span>: <span style="color:#e6db74">&#34;Andy Dufresne is a young and successful banker whose life changes drastically when he is convicted and sentenced to life imprisonment for the murder of his wife and her lover. Set in the 1940s, the film shows how Andy, with the help of his friend Red, the prison entrepreneur, turns out to be a most unconventional prisoner.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ranking&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;rated&#34;</span>: <span style="color:#e6db74">&#34;R&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;rating&#34;</span>: <span style="color:#e6db74">&#34;9.3&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;releaseDate&#34;</span>: <span style="color:#e6db74">&#34;19941014&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;runtime&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;142 min&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;simplePlot&#34;</span>: <span style="color:#e6db74">&#34;Two imprisoned men bond over a number of years, finding solace and eventual redemption through acts of common decency.&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;The Shawshank Redemption&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;Movie&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;urlIMDB&#34;</span>: <span style="color:#e6db74">&#34;http://www.imdb.com/title/tt0111161&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;urlPoster&#34;</span>: <span style="color:#e6db74">&#34;http://ia.media-imdb.com/images/M/MV5BODU4MjU4NjIwNl5BMl5BanBnXkFtZTgwMDU2MjEyMDE@._V1_SX214_AL_.jpg&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;votes&#34;</span>: <span style="color:#e6db74">&#34;1,533,914&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;writers&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Stephen King&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;nameId&#34;</span>: <span style="color:#e6db74">&#34;nm0000175&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Frank Darabont&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;nameId&#34;</span>: <span style="color:#e6db74">&#34;nm0001104&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;year&#34;</span>: <span style="color:#e6db74">&#34;1994&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Of course we want to define our own internal representation with a value object, change some structure and ignore the parts that we consider not relevant. Here&rsquo;s a possible interface for the <code>Movie</code> class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span>NS_ASSUME_NONNULL_BEGIN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">Movie</span> : <span style="color:#a6e22e">NSObject</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">copy</span>, <span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) NSString<span style="color:#f92672">*</span> title;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">copy</span>, <span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) NSNumber<span style="color:#f92672">*</span> rating;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">copy</span>, <span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) NSNumber<span style="color:#f92672">*</span> year;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@property</span> (<span style="color:#66d9ef">copy</span>, <span style="color:#66d9ef">nonatomic</span>, <span style="color:#66d9ef">readonly</span>) NSNumber<span style="color:#f92672">*</span> lengthInMinutes;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (Movie<span style="color:#f92672">*</span>)<span style="color:#a6e22e">withJSONDict:</span>(NSDictionary<span style="color:#f92672">*</span>)dict;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NS_ASSUME_NONNULL_END
</span></span></code></pre></div><p>The class method <code>withJSONDict:</code> will create an instance of <code>Movie</code> from a JSON dictionary like the one showed before: as we can see from the interface declaration, we decided to not allow nil values for any of the properties; but when dealing with JSON, we must consider <strong>every possibility</strong>, including missing keys, null values or wrong types. We&rsquo;re going to use the <code>Optional</code> type to parse the JSON dict in a clean, declarative and error-proof way.</p>
<p>Let&rsquo;s start with the title. From the JSON, the title should be given by the &ldquo;title&rdquo; key, and should be a string (<code>NSString</code> in Objective-C), so we can get the title via the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span> NSString<span style="color:#f92672">*</span> title <span style="color:#f92672">=</span> [[[[Optional
</span></span><span style="display:flex;"><span>                        with:[dict objectForKey:<span style="color:#e6db74">@&#34;title&#34;</span>]]
</span></span><span style="display:flex;"><span>                       
</span></span><span style="display:flex;"><span>                       flatMap:<span style="color:#f92672">^</span>Optional<span style="color:#f92672">*</span>(<span style="color:#66d9ef">id</span> title) {
</span></span><span style="display:flex;"><span>                         <span style="color:#66d9ef">return</span> [Optional with:[title isKindOfClass:[NSString <span style="color:#66d9ef">class</span>]] <span style="color:#f92672">?</span> title : nil];
</span></span><span style="display:flex;"><span>                       }]
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>                      flatMap:<span style="color:#f92672">^</span>Optional<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> title) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> [Optional with:title.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> title : nil];
</span></span><span style="display:flex;"><span>                      }]
</span></span><span style="display:flex;"><span>                     
</span></span><span style="display:flex;"><span>                     getOrElse:<span style="color:#f92672">^</span>NSString<span style="color:#f92672">*</span>{
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">return</span> <span style="color:#e6db74">@&#34;NO TITLE&#34;</span>;
</span></span><span style="display:flex;"><span>                     }];
</span></span></code></pre></div><p>The first <code>flatMap:</code> step means that we want the title to be of <code>NSString</code> class. It&rsquo;s convenient to abstract this operation directly into the <code>Optional</code> constructor, because we&rsquo;re going to do it all the time:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span>+ (Optional <span style="color:#f92672">*</span>)<span style="color:#a6e22e">with:</span>(<span style="color:#66d9ef">id</span>)value <span style="color:#a6e22e">as:</span>(<span style="color:#66d9ef">Class</span>)valueClass
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> ([value isKindOfClass:valueClass])
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [Optional with:value];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [Optional with:nil];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The second <code>flatMap:</code> step means that if the found string is of length 0 (that is, empty), we are going to treat it as unknown. Actually, this step will act as a <strong>filter</strong>, because it will only <em>let pass</em> the strings that are not empty; with that in mind, let&rsquo;s add a <code>filter:</code> method to the <code>Optional</code> class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">filter:</span>(<span style="color:#66d9ef">BOOL</span>(<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span>))filterBlock;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span><span style="color:#75715e">///Optional.m
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>- (Optional<span style="color:#f92672">*</span>)<span style="color:#a6e22e">filter:</span>(<span style="color:#66d9ef">BOOL</span> (<span style="color:#f92672">^</span>)(<span style="color:#66d9ef">id</span> _Nonnull))filterBlock
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> [self flatMap:<span style="color:#f92672">^</span>Optional<span style="color:#f92672">*</span>(<span style="color:#66d9ef">id</span> value) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (filterBlock(value))
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> self;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> [Optional with:nil];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>filter:</code> method takes as parameter a block that returns a <code>BOOL</code> based on the wrapped value: internally, <code>filter:</code> will actually call <code>flatMap:</code>, with a conditional expression to check if the <code>filterBlock</code> succeeds or fails.</p>
<p>Finally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span>NSString<span style="color:#f92672">*</span> title <span style="color:#f92672">=</span> [[[Optional
</span></span><span style="display:flex;"><span>                       with:[dict objectForKey:<span style="color:#e6db74">@&#34;title&#34;</span>]
</span></span><span style="display:flex;"><span>                       as:[NSString <span style="color:#66d9ef">class</span>]]
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>                      filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> string.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                      }]
</span></span><span style="display:flex;"><span>                     
</span></span><span style="display:flex;"><span>                     getOrElse:<span style="color:#f92672">^</span>NSString<span style="color:#f92672">*</span>{ <span style="color:#66d9ef">return</span> <span style="color:#e6db74">@&#34;NO TITLE&#34;</span>; }];
</span></span></code></pre></div><p>So, no conditional statements, and very few lines of code, completely declarative.</p>
<p>For the <code>rating</code> and <code>year</code> parameters we need to add a <code>map</code> to convert the <code>NSString</code> into an <code>NSNumber</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span>NSNumber<span style="color:#f92672">*</span> rating <span style="color:#f92672">=</span> [[[[Optional
</span></span><span style="display:flex;"><span>                         with:[dict objectForKey:<span style="color:#e6db74">@&#34;rating&#34;</span>]
</span></span><span style="display:flex;"><span>                         as:[NSString <span style="color:#66d9ef">class</span>]]
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>                          <span style="color:#66d9ef">return</span> string.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                        }]
</span></span><span style="display:flex;"><span>                       
</span></span><span style="display:flex;"><span>                       map:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> stringValue) {
</span></span><span style="display:flex;"><span>                         <span style="color:#66d9ef">return</span> [NSDecimalNumber decimalNumberWithString:stringValue];
</span></span><span style="display:flex;"><span>                       }]
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>                      getOrElse:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>{ <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@0</span>; }];
</span></span><span style="display:flex;"><span>  movie.rating <span style="color:#f92672">=</span> rating;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  NSNumber<span style="color:#f92672">*</span> year <span style="color:#f92672">=</span> [[[[Optional
</span></span><span style="display:flex;"><span>                       with:[dict objectForKey:<span style="color:#e6db74">@&#34;year&#34;</span>]
</span></span><span style="display:flex;"><span>                       as:[NSString <span style="color:#66d9ef">class</span>]]
</span></span><span style="display:flex;"><span>                      
</span></span><span style="display:flex;"><span>                      filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> string.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>                      }]
</span></span><span style="display:flex;"><span>                     
</span></span><span style="display:flex;"><span>                     map:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> stringValue) {
</span></span><span style="display:flex;"><span>                       <span style="color:#66d9ef">return</span> [NSDecimalNumber decimalNumberWithString:stringValue];
</span></span><span style="display:flex;"><span>                     }]
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    getOrElse:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>{ <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@0</span>; }];
</span></span></code></pre></div><p>The <code>lenghtInMinutes</code> parameter is a little tricky; from the JSON we can see that the value is represented like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JSON" data-lang="JSON"><span style="display:flex;"><span><span style="color:#e6db74">&#34;runtime&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [ 
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;142 min&#34;</span> 
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>So we expect an array, of which we&rsquo;re only interested in the first element (thus, the array must not be empty), that has to be a string; of this string we only need the first part, removing the <code> min</code> portion. Luckily, we already have all the tools for the job:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span>  NSNumber<span style="color:#f92672">*</span> lengthInMinutes <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  [[[[[[Optional
</span></span><span style="display:flex;"><span>        with:[dict objectForKey:<span style="color:#e6db74">@&#34;runtime&#34;</span>]
</span></span><span style="display:flex;"><span>        as:[NSArray <span style="color:#66d9ef">class</span>]]
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>       flatMap:<span style="color:#f92672">^</span>Optional<span style="color:#f92672">*</span>(NSArray<span style="color:#f92672">*</span> array) {
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> [Optional with:[array firstObject]];
</span></span><span style="display:flex;"><span>       }]
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      map:<span style="color:#f92672">^</span>NSString<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [string
</span></span><span style="display:flex;"><span>                stringByReplacingOccurrencesOfString:<span style="color:#e6db74">@&#34; min&#34;</span>
</span></span><span style="display:flex;"><span>                withString:<span style="color:#e6db74">@&#34;&#34;</span>];
</span></span><span style="display:flex;"><span>      }]
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>     filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span> string.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>     }]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    map:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> stringValue) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@(</span>[stringValue integerValue]<span style="color:#ae81ff">)</span>;
</span></span><span style="display:flex;"><span>    }]
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   getOrElse:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>{ <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@0</span>; }];
</span></span></code></pre></div><p>Actually, something is missing: the method <code>[array firstObject]</code> returns the first object of the array if the array has at least one element, or nil if the array is empty: there&rsquo;s no indication that the first object is actually a <code>NSString</code>, so we need to add a <code>filter</code> step to insure that the object is an instance of the correct class. Let&rsquo;s do it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ObjectiveC" data-lang="ObjectiveC"><span style="display:flex;"><span> NSNumber<span style="color:#f92672">*</span> lengthInMinutes <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>  [[[[[[[Optional
</span></span><span style="display:flex;"><span>         with:[dict objectForKey:<span style="color:#e6db74">@&#34;runtime&#34;</span>]
</span></span><span style="display:flex;"><span>         as:[NSArray <span style="color:#66d9ef">class</span>]]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        flatMap:<span style="color:#f92672">^</span><span style="color:#66d9ef">id</span>(NSArray<span style="color:#f92672">*</span> array) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> [Optional with:[array firstObject]];
</span></span><span style="display:flex;"><span>        }]
</span></span><span style="display:flex;"><span>       
</span></span><span style="display:flex;"><span>       filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(<span style="color:#66d9ef">id</span> value) {
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> [value isKindOfClass:[NSString <span style="color:#66d9ef">class</span>]];
</span></span><span style="display:flex;"><span>       }]
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      map:<span style="color:#f92672">^</span>NSString<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> [string
</span></span><span style="display:flex;"><span>                stringByReplacingOccurrencesOfString:<span style="color:#e6db74">@&#34; min&#34;</span>
</span></span><span style="display:flex;"><span>                withString:<span style="color:#e6db74">@&#34;&#34;</span>];
</span></span><span style="display:flex;"><span>      }]
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span>     filter:<span style="color:#f92672">^</span><span style="color:#66d9ef">BOOL</span>(NSString<span style="color:#f92672">*</span> string) {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">return</span> string.length <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>     }]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    map:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>(NSString<span style="color:#f92672">*</span> stringValue) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@(</span>[stringValue integerValue]<span style="color:#ae81ff">)</span>;
</span></span><span style="display:flex;"><span>    }]
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>   getOrElse:<span style="color:#f92672">^</span>NSNumber<span style="color:#f92672">*</span>{ <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">@0</span>; }];
</span></span></code></pre></div><p>As we can see, when we work with the <code>Optional</code> class, adding a condition simply means <strong>adding a step</strong> in the linear <strong>flow of expressions</strong>.</p>
<p><a name="conclusion"></a></p>
<h2 id="conclusion">Conclusion</h2>
<p>Bringing back the <code>Optional</code> type from Swift to Objective-C allowed us to build a JSON parsing routine, often something hard to maintain and error-prone, in a simple, linear and readable way. Of course there&rsquo;s <strong>plenty of cases</strong> where working with optionals can give us the same advantages: by composing <code>map</code>, <code>flatMap</code> and <code>filter</code> operations we can express our intent in a clean and readable way. But this is not just about the <code>Optional</code> type: some readers may have probably noticed that many languages (including Swift) allow operations with the same names on lists and arrays, and the meanings are also the same: <code>map</code> and <code>flatMap</code>, in particular, are <strong>generic concepts</strong> related to monads (in fact, the array type is also a monad) and allow declarative compositions of transformations. This concept is at the core of <strong>functional programming</strong>, and I think there&rsquo;s plenty of reasons to apply similar concepts to a more object-oriented environment: they will help the programmer in reasoning about the code and express the intent in a more declarative way.</p>
<p>The code for the <code>Optional</code> class used throughout the article can be found on <a href="https://gist.github.com/broomburgo/e318228a5f7d6a605e82">GitHub Gist</a>.</p>

  </div>

  

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa-solid fa-folder"></i>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/english">English</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/swift">Swift</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/objective-c">Objective-C</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/functional-programming">Functional programming</a></li>
                
                
                <li><a class="article-category-link" href="https://engineering.facile.it/categories/monad">Monad</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "facile-it" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/blog/ita/optionals-in-objective-c/"
                class="button big previous">Optionals in Objective-C</a></li>
    

    
        <li><a href="/blog/ita/facilehack-2015/"
                class="button big next">#FacileHack 2015</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/images/logo_engineering.png" width="100%" alt="Facile.it Engineering" /></a>
      
    
    
      <header>
        <h2></h2>
        <p>News, repos, tips & trends from the Facile.it Engineering team!</p>
      </header>
    
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa-solid fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/facile-it" target="_blank" title="GitHub" class="fa-brand fa-github"></a></li>



























  <li><a href="//linkedin.com/company/facile-it" target="_blank" title="LinkedIn Company" class="fa-brand fa-linkedin"></a></li>









  <li><a href="//facebook.com/facile.it" target="_blank" title="Facebook" class="fa-brands fa-facebook-square"></a></li>









  <li><a href="//youtube.com/user/Facileit" target="_blank" title="YouTube" class="fa-brand fa-youtube"></a></li>













  <li><a href="//instagram.com/facile.it" target="_blank" title="Instagram" class="fa-brand fa-instagram"></a></li>





  <li><a href="//x.com/FacileIt_Engr" target="_blank" title="Twitter" class="fa-brand fa-square-x-twitter"></a></li>























      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/ana-radujko/" class="author" title="See other posts from Ana Radujko">
                      <img src="https://s.gravatar.com/avatar/13c2d19c1d59562ca74b71f5444943c5?s=80" alt="Ana Radujko avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/v-protetto12-7-2024/">Venerdì Protetto | July edition</a>
              </h3>
              
              <time class="published" datetime='2024-08-28'>
                28 August 2024
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/engineering/" class="author" title="See other posts from Facile.it engineers">
                      <img src="https://avatars1.githubusercontent.com/u/8501934?v=3&amp;s=200" alt="Facile.it engineers avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/v-protetto14-6-2024/">Venerdì Protetto | June edition</a>
              </h3>
              
              <time class="published" datetime='2024-07-02'>
                2 July 2024
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <div class="author-avatars">
                
                  
                    <a href="/authors/agiorgianni/" class="author" title="See other posts from Alessio Giorgianni">
                      <img src="https://www.gravatar.com/avatar" alt="Alessio Giorgianni avatar" class="author-avatar"/>
                    </a>
                  
                
                  
                    <a href="/authors/mgarza/" class="author" title="See other posts from Matteo Garza">
                      <img src="/images/avatar-mgarza.jpeg" alt="Matteo Garza avatar" class="author-avatar"/>
                    </a>
                  
                
              </div>

              <h3>
                <a href="/blog/eng/hack-the-box-experience/">Hack the Box Experience</a>
              </h3>
              
              <time class="published" datetime='2024-05-30'>
                30 May 2024
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /blog/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Top categories</a></h3>
      </header>
        
          
        

        
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/conferences/">Conferences</a>
                <span style="float:right;">10</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/docker/">Docker</a>
                <span style="float:right;">6</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/english/">English</a>
                <span style="float:right;">41</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/functional-programming/">Functional Programming</a>
                <span style="float:right;">11</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/italiano/">Italiano</a>
                <span style="float:right;">34</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/oop/">OOP</a>
                <span style="float:right;">6</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/open-source/">Open Source</a>
                <span style="float:right;">7</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/php/">PHP</a>
                <span style="float:right;">23</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/protected-fridays/">Protected Fridays</a>
                <span style="float:right;">16</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/software-testing/">Software Testing</a>
                <span style="float:right;">7</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/swift/">Swift</a>
                <span style="float:right;">8</span>
              
            </header>
          </article>
        </p>
        
    
            
        <p>
          <article>
            <header>
              
                <a href="https://engineering.facile.it/categories/symfony/">Symfony</a>
                <span style="float:right;">5</span>
              
            </header>
          </article>
        </p>
        
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
        <p>
            <a href="/categories/" class="button">View more categories</a>
        </p>
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>Facile.it relies on a big and keen crew of developers. Since 2008, the group’s projects are based on PHP, and as time goes by new technologies become part of corporate know how. This blog allows our developers to share tips and direct experiences with new technologies.</p>
      <a href="/ita/chi-siamo/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          <li>
            <a href="" type="application/rss+xml" target="_blank" title="RSS" class="fa-solid fa-rss"></a>
          </li>
        
        
  <li><a href="//github.com/facile-it" target="_blank" title="GitHub" class="fa-brand fa-github"></a></li>



























  <li><a href="//linkedin.com/company/facile-it" target="_blank" title="LinkedIn Company" class="fa-brand fa-linkedin"></a></li>









  <li><a href="//facebook.com/facile.it" target="_blank" title="Facebook" class="fa-brands fa-facebook-square"></a></li>









  <li><a href="//youtube.com/user/Facileit" target="_blank" title="YouTube" class="fa-brand fa-youtube"></a></li>













  <li><a href="//instagram.com/facile.it" target="_blank" title="Instagram" class="fa-brand fa-instagram"></a></li>





  <li><a href="//x.com/FacileIt_Engr" target="_blank" title="Twitter" class="fa-brand fa-square-x-twitter"></a></li>























      </ul>
    
    <p class="copyright">
      
        &copy; 2024
        
          Facile.it Engineering
        
      .
      <a href="/ita/disclaimer/" rel="nofollow">Disclaimer</a><br>
      Design <a href="http://html5up.net" rel="nofollow" target="_blank">HTML5 UP</a><br>
      Ported by <a href="//github.com/jpescador" rel="nofollow" target="_blank">Julio Pescador</a><br>
      Modified by <a href="//github.com/Jean85" rel="nofollow" target="_blank">Alessandro Lai</a><br>
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa-solid fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/kotlin.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/objectivec.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/python.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/swift.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
      <script type="text/javascript" src="/js/jquery-lazy/jquery.lazy.min.js"></script>
    

    

    
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    <script type="text/javascript">
        $(function() {
            $('.lazy').Lazy();
        });
    </script>
  </body>
</html>

